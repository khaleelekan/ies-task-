{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/ies-task-/app/api/classes/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\r\nimport { neon } from '@neondatabase/serverless'\r\n\r\nconst sql = neon(process.env.DATABASE_URL!)\r\n\r\nexport async function GET() {\r\n  try {\r\n    const classes = await sql`\r\n      SELECT \r\n        c.id,\r\n        c.name,\r\n        c.teacher,\r\n        c.description,\r\n        c.created_at,\r\n        c.updated_at,\r\n        COUNT(s.id) as number_of_students\r\n      FROM classes c\r\n      LEFT JOIN students s ON c.name = s.class_name\r\n      GROUP BY c.id, c.name, c.teacher, c.description, c.created_at, c.updated_at\r\n      ORDER BY c.created_at DESC\r\n    `\r\n    \r\n    // Parse all number_of_students to integers\r\n    const parsedClasses = classes.map(cls => ({\r\n      ...cls,\r\n      number_of_students: parseInt(cls.number_of_students) || 0\r\n    }))\r\n    \r\n    return NextResponse.json(parsedClasses)\r\n  } catch (error) {\r\n    console.error('Error fetching classes:', error)\r\n    return NextResponse.json(\r\n      { error: 'Failed to fetch classes' },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const { name, teacher, description } = await request.json()\r\n    \r\n    if (!name || !teacher) {\r\n      return NextResponse.json(\r\n        { error: 'Name and teacher are required' },\r\n        { status: 400 }\r\n      )\r\n    }\r\n    \r\n    // Check if class with same name already exists\r\n    const [existingClass] = await sql`\r\n      SELECT * FROM classes WHERE name = ${name}\r\n    `\r\n    \r\n    if (existingClass) {\r\n      return NextResponse.json(\r\n        { error: 'Class with this name already exists' },\r\n        { status: 409 }\r\n      )\r\n    }\r\n    \r\n    const [newClass] = await sql`\r\n      INSERT INTO classes (name, teacher, description) \r\n      VALUES (${name}, ${teacher}, ${description || null}) \r\n      RETURNING *\r\n    `\r\n    \r\n    // Return with number_of_students = 0 for new class\r\n    const newClassWithCount = {\r\n      ...newClass,\r\n      number_of_students: 0\r\n    }\r\n    \r\n    return NextResponse.json(newClassWithCount, { status: 201 })\r\n  } catch (error) {\r\n    console.error('Error creating class:', error)\r\n    return NextResponse.json(\r\n      { error: 'Failed to create class' },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEA,MAAM,MAAM,IAAA,gKAAI,EAAC,QAAQ,GAAG,CAAC,YAAY;AAElC,eAAe;IACpB,IAAI;QACF,MAAM,UAAU,MAAM,GAAG,CAAC;;;;;;;;;;;;;IAa1B,CAAC;QAED,2CAA2C;QAC3C,MAAM,gBAAgB,QAAQ,GAAG,CAAC,CAAA,MAAO,CAAC;gBACxC,GAAG,GAAG;gBACN,oBAAoB,SAAS,IAAI,kBAAkB,KAAK;YAC1D,CAAC;QAED,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,2BAA2B;QACzC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAA0B,GACnC;YAAE,QAAQ;QAAI;IAElB;AACF;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,EAAE,IAAI,EAAE,OAAO,EAAE,WAAW,EAAE,GAAG,MAAM,QAAQ,IAAI;QAEzD,IAAI,CAAC,QAAQ,CAAC,SAAS;YACrB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAgC,GACzC;gBAAE,QAAQ;YAAI;QAElB;QAEA,+CAA+C;QAC/C,MAAM,CAAC,cAAc,GAAG,MAAM,GAAG,CAAC;yCACG,EAAE,KAAK;IAC5C,CAAC;QAED,IAAI,eAAe;YACjB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAsC,GAC/C;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,CAAC,SAAS,GAAG,MAAM,GAAG,CAAC;;cAEnB,EAAE,KAAK,EAAE,EAAE,QAAQ,EAAE,EAAE,eAAe,KAAK;;IAErD,CAAC;QAED,mDAAmD;QACnD,MAAM,oBAAoB;YACxB,GAAG,QAAQ;YACX,oBAAoB;QACtB;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC,mBAAmB;YAAE,QAAQ;QAAI;IAC5D,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAyB,GAClC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}