{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/ies-task-/app/api/search/route.ts"],"sourcesContent":["// app/api/search/route.ts - UPDATED VERSION\r\nimport { NextRequest, NextResponse } from 'next/server'\r\nimport { neon } from '@neondatabase/serverless'\r\n\r\nconst sql = neon(process.env.DATABASE_URL!)\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const { searchParams } = new URL(request.url)\r\n    const query = searchParams.get('q')?.trim()\r\n    const limit = parseInt(searchParams.get('limit') || '10')\r\n\r\n    if (!query || query.length < 2) {\r\n      return NextResponse.json({\r\n        error: 'Search query must be at least 2 characters long',\r\n        results: []\r\n      }, { status: 400 })\r\n    }\r\n\r\n    const searchPattern = `%${query}%`\r\n    \r\n    // Search across all tables\r\n    const results = await sql`\r\n      -- Search students\r\n      SELECT \r\n        id,\r\n        'student' as type,\r\n        name as title,\r\n        COALESCE(email, 'No email') as subtitle,\r\n        COALESCE(class_name, 'No class assigned') as description,\r\n        created_at\r\n      FROM students \r\n      WHERE name ILIKE ${searchPattern}\r\n         OR email ILIKE ${searchPattern}\r\n         OR class_name ILIKE ${searchPattern}\r\n      \r\n      UNION ALL\r\n      \r\n      -- Search classes\r\n      SELECT \r\n        id,\r\n        'class' as type,\r\n        name as title,\r\n        teacher as subtitle,\r\n        COALESCE(description, 'No description') as description,\r\n        created_at\r\n      FROM classes \r\n      WHERE name ILIKE ${searchPattern}\r\n         OR teacher ILIKE ${searchPattern}\r\n         OR description ILIKE ${searchPattern}\r\n      \r\n      UNION ALL\r\n      \r\n      -- Search attendance\r\n      SELECT \r\n        id,\r\n        'attendance' as type,\r\n        COALESCE(student_name, 'Unknown') as title,\r\n        TO_CHAR(date, 'Mon DD, YYYY') as subtitle,\r\n        'Status: ' || COALESCE(status, 'Unknown') as description,\r\n        created_at\r\n      FROM attendance \r\n      WHERE student_name ILIKE ${searchPattern}\r\n         OR class_name ILIKE ${searchPattern}\r\n      \r\n      ORDER BY created_at DESC\r\n      LIMIT ${limit}\r\n    `\r\n\r\n    // Format results with correct URLs to your existing pages\r\n    const formattedResults = results.map((result: any) => {\r\n      let icon = 'üîç'\r\n      let href = ''\r\n      let label = ''\r\n      \r\n      switch (result.type) {\r\n        case 'student':\r\n          icon = 'üë§'\r\n          href = '/students'  // Your students page\r\n          label = 'Go to Students'\r\n          break\r\n        case 'class':\r\n          icon = 'üìö'\r\n          href = '/classes'   // Your classes page\r\n          label = 'Go to Classes'\r\n          break\r\n        case 'attendance':\r\n          icon = '‚úÖ'\r\n          href = '/attendance' // Your attendance page if exists, otherwise remove this\r\n          label = 'Go to Attendance'\r\n          break\r\n      }\r\n\r\n      return {\r\n        id: result.id,\r\n        type: result.type,\r\n        title: result.title,\r\n        subtitle: result.subtitle,\r\n        description: result.description || '',\r\n        icon,\r\n        href,\r\n        label,\r\n        createdAt: result.created_at\r\n      }\r\n    })\r\n\r\n    return NextResponse.json({\r\n      query,\r\n      total: formattedResults.length,\r\n      results: formattedResults\r\n    })\r\n\r\n  } catch (error) {\r\n    console.error('Search API error:', error)\r\n    return NextResponse.json({\r\n      error: 'Failed to perform search',\r\n      message: error instanceof Error ? error.message : 'Unknown error',\r\n      results: []\r\n    }, { status: 500 })\r\n  }\r\n}"],"names":[],"mappings":"AAAA,4CAA4C;;;;;AAC5C;AACA;;;AAEA,MAAM,MAAM,IAAA,gKAAI,EAAC,QAAQ,GAAG,CAAC,YAAY;AAElC,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,QAAQ,aAAa,GAAG,CAAC,MAAM;QACrC,MAAM,QAAQ,SAAS,aAAa,GAAG,CAAC,YAAY;QAEpD,IAAI,CAAC,SAAS,MAAM,MAAM,GAAG,GAAG;YAC9B,OAAO,gJAAY,CAAC,IAAI,CAAC;gBACvB,OAAO;gBACP,SAAS,EAAE;YACb,GAAG;gBAAE,QAAQ;YAAI;QACnB;QAEA,MAAM,gBAAgB,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC;QAElC,2BAA2B;QAC3B,MAAM,UAAU,MAAM,GAAG,CAAC;;;;;;;;;;uBAUP,EAAE,cAAc;wBACf,EAAE,cAAc;6BACX,EAAE,cAAc;;;;;;;;;;;;;uBAatB,EAAE,cAAc;0BACb,EAAE,cAAc;8BACZ,EAAE,cAAc;;;;;;;;;;;;;+BAaf,EAAE,cAAc;6BAClB,EAAE,cAAc;;;YAGjC,EAAE,MAAM;IAChB,CAAC;QAED,0DAA0D;QAC1D,MAAM,mBAAmB,QAAQ,GAAG,CAAC,CAAC;YACpC,IAAI,OAAO;YACX,IAAI,OAAO;YACX,IAAI,QAAQ;YAEZ,OAAQ,OAAO,IAAI;gBACjB,KAAK;oBACH,OAAO;oBACP,OAAO,aAAa,qBAAqB;oBACzC,QAAQ;oBACR;gBACF,KAAK;oBACH,OAAO;oBACP,OAAO,YAAa,oBAAoB;oBACxC,QAAQ;oBACR;gBACF,KAAK;oBACH,OAAO;oBACP,OAAO,eAAc,wDAAwD;oBAC7E,QAAQ;oBACR;YACJ;YAEA,OAAO;gBACL,IAAI,OAAO,EAAE;gBACb,MAAM,OAAO,IAAI;gBACjB,OAAO,OAAO,KAAK;gBACnB,UAAU,OAAO,QAAQ;gBACzB,aAAa,OAAO,WAAW,IAAI;gBACnC;gBACA;gBACA;gBACA,WAAW,OAAO,UAAU;YAC9B;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB;YACA,OAAO,iBAAiB,MAAM;YAC9B,SAAS;QACX;IAEF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,qBAAqB;QACnC,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,OAAO;YACP,SAAS,iBAAiB,QAAQ,MAAM,OAAO,GAAG;YAClD,SAAS,EAAE;QACb,GAAG;YAAE,QAAQ;QAAI;IACnB;AACF"}}]
}