{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/i-e-school-admin-panel/app/api/classes/%5Bid%5D/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\r\nimport { neon } from '@neondatabase/serverless'\r\n\r\nconst sql = neon(process.env.DATABASE_URL!)\r\n\r\nexport async function DELETE(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> } // params is now a Promise\r\n) {\r\n  try {\r\n    // Await the params to get the actual values\r\n    const { id } = await params\r\n    \r\n    // First check if class exists\r\n    const [existingClass] = await sql`\r\n      SELECT * FROM classes WHERE id = ${id}\r\n    `\r\n    \r\n    if (!existingClass) {\r\n      return NextResponse.json(\r\n        { error: 'Class not found' },\r\n        { status: 404 }\r\n      )\r\n    }\r\n    \r\n    // Check if class has students\r\n    const [hasStudents] = await sql`\r\n      SELECT COUNT(*) as count FROM students \r\n      WHERE class_name = ${existingClass.name}\r\n    `\r\n    \r\n    if (parseInt(hasStudents.count) > 0) {\r\n      return NextResponse.json(\r\n        { error: 'Cannot delete class with enrolled students' },\r\n        { status: 400 }\r\n      )\r\n    }\r\n    \r\n    // Delete the class\r\n    await sql`DELETE FROM classes WHERE id = ${id}`\r\n    \r\n    return NextResponse.json(\r\n      { message: 'Class deleted successfully' },\r\n      { status: 200 }\r\n    )\r\n  } catch (error) {\r\n    console.error('Error deleting class:', error)\r\n    return NextResponse.json(\r\n      { error: 'Failed to delete class' },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}\r\n\r\n// Add GET method to fetch a single class (optional)\r\nexport async function GET(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    const { id } = await params\r\n    \r\n    const [classItem] = await sql`\r\n      SELECT * FROM classes WHERE id = ${id}\r\n    `\r\n    \r\n    if (!classItem) {\r\n      return NextResponse.json(\r\n        { error: 'Class not found' },\r\n        { status: 404 }\r\n      )\r\n    }\r\n    \r\n    return NextResponse.json(classItem)\r\n  } catch (error) {\r\n    console.error('Error fetching class:', error)\r\n    return NextResponse.json(\r\n      { error: 'Failed to fetch class' },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}\r\n\r\n// Add PUT method to update a class (optional)\r\nexport async function PUT(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    const { id } = await params\r\n    const { name, teacher, description } = await request.json()\r\n    \r\n    // Check if class exists\r\n    const [existingClass] = await sql`\r\n      SELECT * FROM classes WHERE id = ${id}\r\n    `\r\n    \r\n    if (!existingClass) {\r\n      return NextResponse.json(\r\n        { error: 'Class not found' },\r\n        { status: 404 }\r\n      )\r\n    }\r\n    \r\n    // Update the class\r\n    const [updatedClass] = await sql`\r\n      UPDATE classes \r\n      SET \r\n        name = COALESCE(${name}, name),\r\n        teacher = COALESCE(${teacher}, teacher),\r\n        description = COALESCE(${description}, description),\r\n        updated_at = NOW()\r\n      WHERE id = ${id}\r\n      RETURNING *\r\n    `\r\n    \r\n    return NextResponse.json(updatedClass)\r\n  } catch (error) {\r\n    console.error('Error updating class:', error)\r\n    return NextResponse.json(\r\n      { error: 'Failed to update class' },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}"],"names":[],"mappings":";;;;;;;;AAAA;AACA;;;AAEA,MAAM,MAAM,IAAA,gKAAI,EAAC,QAAQ,GAAG,CAAC,YAAY;AAElC,eAAe,OACpB,OAAoB,EACpB,EAAE,MAAM,EAAuC,CAAC,0BAA0B;AAA3B;IAE/C,IAAI;QACF,4CAA4C;QAC5C,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM;QAErB,8BAA8B;QAC9B,MAAM,CAAC,cAAc,GAAG,MAAM,GAAG,CAAC;uCACC,EAAE,GAAG;IACxC,CAAC;QAED,IAAI,CAAC,eAAe;YAClB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAkB,GAC3B;gBAAE,QAAQ;YAAI;QAElB;QAEA,8BAA8B;QAC9B,MAAM,CAAC,YAAY,GAAG,MAAM,GAAG,CAAC;;yBAEX,EAAE,cAAc,IAAI,CAAC;IAC1C,CAAC;QAED,IAAI,SAAS,YAAY,KAAK,IAAI,GAAG;YACnC,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA6C,GACtD;gBAAE,QAAQ;YAAI;QAElB;QAEA,mBAAmB;QACnB,MAAM,GAAG,CAAC,+BAA+B,EAAE,GAAG,CAAC;QAE/C,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,SAAS;QAA6B,GACxC;YAAE,QAAQ;QAAI;IAElB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAyB,GAClC;YAAE,QAAQ;QAAI;IAElB;AACF;AAGO,eAAe,IACpB,OAAoB,EACpB,EAAE,MAAM,EAAuC;IAE/C,IAAI;QACF,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM;QAErB,MAAM,CAAC,UAAU,GAAG,MAAM,GAAG,CAAC;uCACK,EAAE,GAAG;IACxC,CAAC;QAED,IAAI,CAAC,WAAW;YACd,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAkB,GAC3B;gBAAE,QAAQ;YAAI;QAElB;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAwB,GACjC;YAAE,QAAQ;QAAI;IAElB;AACF;AAGO,eAAe,IACpB,OAAoB,EACpB,EAAE,MAAM,EAAuC;IAE/C,IAAI;QACF,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM;QACrB,MAAM,EAAE,IAAI,EAAE,OAAO,EAAE,WAAW,EAAE,GAAG,MAAM,QAAQ,IAAI;QAEzD,wBAAwB;QACxB,MAAM,CAAC,cAAc,GAAG,MAAM,GAAG,CAAC;uCACC,EAAE,GAAG;IACxC,CAAC;QAED,IAAI,CAAC,eAAe;YAClB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAkB,GAC3B;gBAAE,QAAQ;YAAI;QAElB;QAEA,mBAAmB;QACnB,MAAM,CAAC,aAAa,GAAG,MAAM,GAAG,CAAC;;;wBAGb,EAAE,KAAK;2BACJ,EAAE,QAAQ;+BACN,EAAE,YAAY;;iBAE5B,EAAE,GAAG;;IAElB,CAAC;QAED,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAyB,GAClC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}